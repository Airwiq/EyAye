<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <title>Main</title>
    <style>
        html,
        body {}

        canvas {
            border: 1px solid black;
        }
    </style>
</head>

<body>
    <img src="./res/img/rgby.png" style="display: none">
    <canvas id="cvs" width="1024" height="1024"></canvas>
</body>
<script>
    const IMX = { w: 15, h: 15, d: 15 };    
    var DATA = null;
    var img = new Image();
    img.onload = function () {
        let cvs = document.createElement('canvas');
        cvs.width = img.width;
        cvs.height = img.height;
        let c = cvs.getContext('2d');
        c.drawImage(img, 0, 0);
        DATA = [];
        for (let i = 0; i < IMX.h; i++) {
            let mX = 0;
            let mY = (i) * IMX.h;
            for (let y = 0; y < IMX.d; y++) {
                for (let x = 0; x < IMX.w; x++) {
                    let col = c.getImageData(mX + x, mY + y, 1, 1).data;
                    if (col[3] > 0) {
                        DATA.push({
                            X: x,
                            Y: i,
                            Z: y,
                            C: col
                        });
                    }
                }
            }
            //document.getElementById('cvs').getContext('2d').drawImage(img,0, i*IMX.h, IMX.w, IMX.d,0,0,512,512);
        }
        run();
    }
    img.src = './res/img/cube.png';
    function cX(x, y, z, t) {
        return (x - z) * (t / 2);
    }
    function cY(y, t) {
        return y * (t);
    }
    function cZ(x, y, z, t) {
        return (x + z) * (t / 2) - cY(y, t);
    }
    function drawPlane(cvs, tw, th, x1, y1, z1, x2, y2, z2, x3, y3, z3, x4, y4, z4, col) {
        let shd = 0;
        cvs.fillStyle = `rgba(${col[0]},${col[1]},${col[2]},${col[3]})`;
        cvs.strokeStyle = `rgba(${col[0]+shd},${col[1]+shd},${col[2]+shd},${col[3]})`;
        cvs.lineWidth = 0.5;
        cvs.beginPath();
        cvs.moveTo(cX(x1, y1, z1, tw), cZ(x1, y1, z1, th));
        cvs.lineTo(cX(x2, y2, z2, tw), cZ(x2, y2, z2, th));
        cvs.lineTo(cX(x3, y3, z3, tw), cZ(x3, y3, z3, th));
        cvs.lineTo(cX(x4, y4, z4, tw), cZ(x4, y4, z4, th));
        cvs.closePath();
        cvs.fill();
        cvs.stroke();
    }
    function drawPlaneY(cvs, s, tw, th, x, y, z, col) {
        drawPlane(cvs, tw, th,
            x - s, y, z - s,
            x + s, y, z - s,
            x + s, y, z + s,
            x - s, y, z + s,
            col
        );
    }
    function drawPlaneX(cvs, s, tw, th, x, y, z, col) {
        drawPlane(cvs, tw, th,
            x, y - s, z - s,
            x, y + s, z - s,
            x, y + s, z + s,
            x, y - s, z + s,
            col
        );
    }
    function drawPlaneZ(cvs, s, tw, th, x, y, z, col) {
        drawPlane(cvs, tw, th,
            x - s, y - s, z,
            x + s, y - s, z,
            x + s, y + s, z,
            x - s, y + s, z,
            col
        );
    }
    function drawCube(cvs, s, tw, th, x, y, z, col) {
        let sdh = 24;

        drawPlaneY(cvs, s, tw, th, x, y - s, z, col);
        drawPlaneX(cvs, s, tw, th, x - s, y, z, col);
        drawPlaneZ(cvs, s, tw, th, x, y, z - s, col);
        drawPlaneX(cvs, s, tw, th, x + s, y, z, [col[0]-sdh,col[1]-sdh,col[2]-sdh,col[3]]);
        drawPlaneZ(cvs, s, tw, th, x, y, z + s, [col[0]-sdh,col[1]-sdh,col[2]-sdh,col[3]]);
        drawPlaneY(cvs, s, tw, th, x, y + s, z, col);
    }
</script>
<script>
    function run() {
        let tw = 8;
        let th = 4;

        let c = document.getElementById('cvs').getContext('2d');
        c.translate(512,512);
        for (let i = 0, v; v = DATA[i]; i++) {
            
            drawCube(c, 0.5, tw, th, v.X+100, v.Y, v.Z, v.C);
        }


    }
</script>


</html>